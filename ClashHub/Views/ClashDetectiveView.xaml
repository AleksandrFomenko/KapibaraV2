<ui:FluentWindow
    x:Class="ClashHub.Views.ClashDetectiveView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:ui="http://Kapibara/xaml"
    xmlns:converters1="clr-namespace:ClashHub.Views.Converters"
    mc:Ignorable="d"
    WindowStartupLocation="CenterScreen"
    Width="1200"
    Height="800"
    ScrollViewer.CanContentScroll="False"
    ExtendsContentIntoTitleBar="True">

    <ui:FluentWindow.Resources>
        <converters1:BoolVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters1:FilePathToImageConverter x:Key="FilePathToImageConverter"/>
    </ui:FluentWindow.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="40" />
            <RowDefinition Height="50" />
            <RowDefinition Height="*" />
            <RowDefinition Height="2.5*" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <ui:TitleBar Grid.Row="0" Title="Clash navigator"/>
        <StackPanel Grid.Row="1" Orientation="Horizontal">
            <Separator Width="20" Visibility="Hidden"/>
            <ComboBox
                ItemsSource="{Binding Formats}"
                SelectedItem="{Binding SelectedFormat}"
                DisplayMemberPath="FormatName"/>
            <Separator Width="20" Visibility="Hidden"/>
            <ui:Button
                Appearance="Primary" 
                Content="Выбрать путь к файлу"
                Command="{Binding SelectPathCommand}"/>
            <Separator Width="20" Visibility="Hidden"/>
            <ui:TextBlock
                VerticalAlignment="Center"
                Text="{Binding PathToFile}"/>
        </StackPanel>
        
        <ui:DataGrid Grid.Row="2" 
                     Margin="10, 10"
                     ItemsSource="{Binding Checks}"
                     SelectedItem="{Binding SelectedCheck}"
                     IsReadOnly="True"
                     AutoGenerateColumns="False"
                     CanUserAddRows="False"
                     CanUserDeleteRows="False" >
            <ui:DataGrid.Columns>
                <DataGridTextColumn Header="Name" Binding="{Binding Name}" />
                <DataGridTextColumn Header="Total" Binding="{Binding Summary.Total}" />
                <DataGridTextColumn Header="New" Binding="{Binding Summary.New}" />
                <DataGridTextColumn Header="Active" Binding="{Binding Summary.Active}" />
                <DataGridTextColumn Header="Reviewed" Binding="{Binding Summary.Reviewed}" />
                <DataGridTextColumn Header="Approved" Binding="{Binding Summary.Approved}" />
                <DataGridTextColumn Header="Resolved" Binding="{Binding Summary.Resolved}" />
                <DataGridTextColumn Header="Test Type" Binding="{Binding Summary.TestType}" />
            </ui:DataGrid.Columns>
        </ui:DataGrid>
        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1.5*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            
            <ui:DataGrid Grid.Column="0" 
                         Margin="10, 10"
                         ItemsSource="{Binding Collisions}"
                         SelectedItem="{Binding SelectedCollision}"
                         IsReadOnly="True"
                         AutoGenerateColumns="False"
                         CanUserAddRows="False"
                         CanUserDeleteRows="False">
                <ui:DataGrid.Columns>
                    <DataGridTextColumn Header="Name"
                                        Binding="{Binding Name}" />
                    <DataGridTemplateColumn Header="Status">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ComboBox
                                    Margin="5"
                                    ItemsSource="{Binding StatusList}" 
                                    SelectedItem="{Binding StatusFromList,
                                    Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                    DisplayMemberPath="."/>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn Header="Distance"
                                        Binding="{Binding Distance}" />
                    <DataGridTextColumn Header="Created At"
                                        Binding="{Binding Created, StringFormat=G}" />
                </ui:DataGrid.Columns>
            </ui:DataGrid>
            <Image Grid.Column="1"
                   Margin="5"
                   Source="{Binding SelectedCollisionImagePath,
                   Converter={StaticResource FilePathToImageConverter}}"
                   Stretch="Uniform"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"/>
        </Grid>
        <Grid Grid.Row="4">
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid Grid.Row="0" Margin="15,0,15,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <ui:ToggleSwitch Grid.Column="0"
                                 OffContent="Hide elements"
                                 OnContent="Show elements"
                                 IsChecked="{Binding VisibleElementsInfo}"/>
                <ui:Button Grid.Column="1"
                           Margin="0,0,80,0"
                           HorizontalAlignment="Right"
                           Content="Select element"
                           Appearance="Secondary"
                           Visibility="{Binding VisibleElementsInfo,
                           Converter={StaticResource BoolToVisibilityConverter}}" />
                <ui:Button Grid.Column="2"
                           HorizontalAlignment="Right"
                           Content="Select element"
                           Appearance="Secondary"
                           Visibility="{Binding VisibleElementsInfo,
                           Converter={StaticResource BoolToVisibilityConverter}}" />
            </Grid>
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <ui:Card Grid.Column="0" Margin="10, 5,5,5" 
                         Visibility="{Binding VisibleElementsInfo,
                         Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel>
                        <TextBlock Text="Element 1"/>
                        <TextBlock Text="{Binding FirstElement.Type}"/>
                        <TextBlock Text="{Binding FirstElement.TypeFamily}"/>
                        <TextBlock Text="{Binding FirstElement.Id}"/>
                    </StackPanel>
                </ui:Card>
                
                <ui:Card Grid.Column="1" Margin="5, 5,10,5"  
                         Visibility="{Binding VisibleElementsInfo,
                         Converter={StaticResource BoolToVisibilityConverter}}">
                    <StackPanel>
                        <TextBlock Text="Element 2"/>
                        <TextBlock Text="{Binding SecondElement.Type}"/>
                        <TextBlock Text="{Binding SecondElement.TypeFamily}"/>
                        <TextBlock Text="{Binding SecondElement.Id}"/>
                    </StackPanel>
                </ui:Card>
            </Grid>
        </Grid>
    </Grid>
</ui:FluentWindow>