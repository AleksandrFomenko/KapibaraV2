<ui:FluentWindow
    x:Class="ClashDetective.Views.ClashDetectiveView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:viewModel="clr-namespace:ClashDetective.ViewModels"
    xmlns:ui="http://Kapibara/xaml"
    xmlns:converters="clr-namespace:ClashDetective.Views.Converters"
    mc:Ignorable="d"
    d:DataContext="{d:DesignInstance viewModel:ClashDetectiveViewModel}"
    WindowStartupLocation="CenterScreen"
    Width="1200"
    Height="800"
    ScrollViewer.CanContentScroll="False"
    ExtendsContentIntoTitleBar="True">
    <Window.Resources>
        <converters:FilePathToImageConverter x:Key="FilePathToImageConverter"/>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="40" />
            <RowDefinition Height="50" />
            <RowDefinition Height="*" />
            <RowDefinition Height="3*" />
        </Grid.RowDefinitions>
        <ui:TitleBar Grid.Row="0" Title="Clash navigator"/>
        <StackPanel Grid.Row="1" Orientation="Horizontal">
            <Separator Width="20" Visibility="Hidden"/>
            <ComboBox
                ItemsSource="{Binding Formats}"
                SelectedItem="{Binding SelectedFormat}"
                DisplayMemberPath="Name"/>
            <Separator Width="20" Visibility="Hidden"/>
            <ui:Button 
                Appearance="Primary" 
                Content="Выбрать путь к файлу"
                Command="{Binding SelectPathCommand}"/>
            <Separator Width="20" Visibility="Hidden"/>
            <ui:TextBlock
                VerticalAlignment="Center"
                Text="{Binding PathToFile}"/>
        </StackPanel>
        
        <ui:DataGrid Grid.Row="2" 
                     Margin="10, 10"
                     ItemsSource="{Binding Checks}"
                     SelectedItem="{Binding SelectedCheck}"
                     IsReadOnly="True"
                     AutoGenerateColumns="False"
                     CanUserAddRows="False"
                     CanUserDeleteRows="False" >
            <ui:DataGrid.Columns>
                <DataGridTextColumn Header="Name"  Binding="{Binding Name}" />
                <DataGridTextColumn Header="Total"      Binding="{Binding Summary.Total}" />
                <DataGridTextColumn Header="New"      Binding="{Binding Summary.New}" />
                <DataGridTextColumn Header="Active"     Binding="{Binding Summary.Active}" />
                <DataGridTextColumn Header="Reviewed"     Binding="{Binding Summary.Reviewed}" />
                <DataGridTextColumn Header="Approved"     Binding="{Binding Summary.Approved}" />
                <DataGridTextColumn Header="Resolved"     Binding="{Binding Summary.Resolved}" />
                <DataGridTextColumn Header="Test Type"  Binding="{Binding Summary.TestType}" />
            </ui:DataGrid.Columns>
        </ui:DataGrid>
        <Grid Grid.Row="3">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="1.5*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            
            <ui:DataGrid Grid.Column="0" 
                         Margin="10, 10"
                         ItemsSource="{Binding Collisions}"
                         SelectedItem="{Binding SelectedCollision}"
                         IsReadOnly="True"
                         AutoGenerateColumns="False"
                         CanUserAddRows="False"
                         CanUserDeleteRows="False">
                <ui:DataGrid.Columns>
                    <DataGridTextColumn Header="Name"
                                        Binding="{Binding Name}" />
                    <DataGridTemplateColumn Header="Действие">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <ui:Button
                                    Icon="{ui:SymbolIcon Glasses16}" 
                                    Appearance="Caution"
                                    Command="{Binding OpenCollisionCommand, 
                      RelativeSource={RelativeSource AncestorType=ui:DataGrid}}"
                                    CommandParameter="{Binding}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    
                    <DataGridTextColumn Header="Status"
                                        Binding="{Binding Status}" />
                    <DataGridTextColumn Header="Distance"
                                        Binding="{Binding Distance}" />
                    <DataGridTextColumn Header="Type element"
                                        Binding="{Binding Path=ClashObjects
                                        .Items[0]
                                        .SmartTags[0]
                                        .Value}" />
                    <DataGridTextColumn Header="Element 1"
                                        Binding="{Binding Path=ClashObjects
                                        .Items[0]
                                        .ObjectAttribute
                                        .Value}" />
                    <DataGridTextColumn Header="Type element"
                                        Binding="{Binding Path=ClashObjects
                                        .Items[1]
                                        .SmartTags[0]
                                        .Value}" />
                    <DataGridTextColumn Header="Element 2"
                                        Binding="{Binding Path=ClashObjects
                                        .Items[1]
                                        .ObjectAttribute
                                        .Value}" />
                    <DataGridTextColumn Header="Created At"
                                        Binding="{Binding Created, StringFormat=G}" />
                </ui:DataGrid.Columns>
            </ui:DataGrid>
            <Image Grid.Column="1"
                   Margin="5"
                   Source="{Binding SelectedCollisionImagePath,
                   Converter={StaticResource FilePathToImageConverter}}"
                   Stretch="Uniform"
                   HorizontalAlignment="Center"
                   VerticalAlignment="Center"/>
        </Grid>
    </Grid>
</ui:FluentWindow>